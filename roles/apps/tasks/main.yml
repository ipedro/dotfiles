---
# App-specific configuration restoration
# Exports settings with: defaults export <domain> <file>.plist
# Update configs by re-exporting after making changes in the app

# =============================================================================
# BetterDisplay
# =============================================================================
- name: Check if BetterDisplay config exists
  ansible.builtin.stat:
    path: "{{ playbook_dir }}/files/app-configs/BetterDisplay.plist"
  register: betterdisplay_config

- name: Restore BetterDisplay settings
  ansible.builtin.shell: |
    killall BetterDisplay 2>/dev/null || true
    defaults import pro.betterdisplay.BetterDisplay "{{ playbook_dir }}/files/app-configs/BetterDisplay.plist"
  when: betterdisplay_config.stat.exists
  changed_when: true

# =============================================================================
# Fork (Git client)
# =============================================================================
- name: Check if Fork config exists
  ansible.builtin.stat:
    path: "{{ playbook_dir }}/files/app-configs/Fork.plist"
  register: fork_config

- name: Restore Fork settings
  ansible.builtin.shell: |
    killall Fork 2>/dev/null || true
    defaults import com.DanPristupov.Fork "{{ playbook_dir }}/files/app-configs/Fork.plist"
  when: fork_config.stat.exists
  changed_when: true

# =============================================================================
# Terminal.app
# =============================================================================
- name: Check if Terminal config exists
  ansible.builtin.stat:
    path: "{{ playbook_dir }}/files/app-configs/Terminal.plist"
  register: terminal_config

- name: Restore Terminal settings
  ansible.builtin.shell: |
    killall Terminal 2>/dev/null || true
    defaults import com.apple.Terminal "{{ playbook_dir }}/files/app-configs/Terminal.plist"
  when: terminal_config.stat.exists
  changed_when: true

# =============================================================================
# Xcode
# =============================================================================
- name: Check if Xcode config exists
  ansible.builtin.stat:
    path: "{{ playbook_dir }}/files/app-configs/Xcode.plist"
  register: xcode_config

- name: Restore Xcode settings
  ansible.builtin.shell: |
    killall Xcode 2>/dev/null || true
    defaults import com.apple.dt.Xcode "{{ playbook_dir }}/files/app-configs/Xcode.plist"
  when: xcode_config.stat.exists
  changed_when: true

- name: Ensure Xcode FontAndColorThemes directory exists
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/Library/Developer/Xcode/UserData/FontAndColorThemes"
    state: directory
    mode: "0755"

- name: Restore Xcode color themes (with JetBrains Mono 15pt)
  ansible.builtin.copy:
    src: "{{ playbook_dir }}/files/xcode-themes/"
    dest: "{{ ansible_env.HOME }}/Library/Developer/Xcode/UserData/FontAndColorThemes/"
    mode: "0644"

# =============================================================================
# Safari
# =============================================================================
- name: Check if Safari config exists
  ansible.builtin.stat:
    path: "{{ playbook_dir }}/files/app-configs/Safari.plist"
  register: safari_config

- name: Restore Safari settings
  ansible.builtin.shell: |
    killall Safari 2>/dev/null || true
    defaults import com.apple.Safari "{{ playbook_dir }}/files/app-configs/Safari.plist"
  when: safari_config.stat.exists
  changed_when: true

# =============================================================================
# Google Chrome
# =============================================================================
- name: Check if Chrome config exists
  ansible.builtin.stat:
    path: "{{ playbook_dir }}/files/app-configs/Chrome.plist"
  register: chrome_config

- name: Restore Chrome settings
  ansible.builtin.shell: |
    killall "Google Chrome" 2>/dev/null || true
    defaults import com.google.Chrome "{{ playbook_dir }}/files/app-configs/Chrome.plist"
  when: chrome_config.stat.exists
  changed_when: true

# =============================================================================
# Sketch
# =============================================================================
- name: Check if Sketch config exists
  ansible.builtin.stat:
    path: "{{ playbook_dir }}/files/app-configs/Sketch.plist"
  register: sketch_config

- name: Restore Sketch settings
  ansible.builtin.shell: |
    killall Sketch 2>/dev/null || true
    defaults import com.bohemiancoding.sketch3 "{{ playbook_dir }}/files/app-configs/Sketch.plist"
  when: sketch_config.stat.exists
  changed_when: true